{% extends "base.html" %}

{% block content %}
<section>
    <h2>My account</h2>
    {% if status == "profile-updated" %}
        <p style="color:#27ae60;">Profile updated.</p>
    {% elif status == "password-updated" %}
        <p style="color:#27ae60;">Password updated.</p>
    {% endif %}
    {% if error %}
        <p style="color:#c0392b;">{{ error }}</p>
    {% endif %}
    {% if force == "password" or user_obj.must_change_password %}
        <p style="color:#e67e22;">You must change your password before exploring the rest of the application.</p>
    {% endif %}
    {% if ldap_managed %}
        <p style="color:#2980b9;">Account is managed by the LDAP server and cannot be changed in this application.</p>
    {% endif %}
</section>

<section style="display:flex; gap:2rem; flex-wrap:wrap;">
    <div style="flex:1; min-width:280px;">
        <h3>Profile</h3>
        <form method="post" action="/account/profile">
            <fieldset {% if ldap_managed %}disabled style="opacity:0.55; filter:grayscale(1);" aria-disabled="true"{% endif %}>
            <label for="full_name">Full name</label>
            <input id="full_name" name="full_name" type="text" value="{{ user_obj.full_name or '' }}">

            <label for="email">Email</label>
            <input id="email" name="email" type="email" value="{{ user_obj.email or '' }}">

            <p><strong>Username:</strong> {{ user_obj.username }}</p>
            <button type="submit">Save profile</button>
            </fieldset>
        </form>
    </div>
    <div style="flex:1; min-width:280px;">
        <h3>Change password</h3>
        <form method="post" action="/account/password">
            <fieldset {% if ldap_managed %}disabled style="opacity:0.55; filter:grayscale(1);" aria-disabled="true"{% endif %}>
            <label for="current_password">Current password</label>
            <input id="current_password" name="current_password" type="password" required>

            <label for="new_password">New password</label>
            <input id="new_password" name="new_password" type="password" minlength="8" required>

            <label for="confirm_password">Confirm new password</label>
            <input id="confirm_password" name="confirm_password" type="password" minlength="8" required>

            <button type="submit">Update password</button>
            </fieldset>
        </form>
    </div>
</section>
{% endblock %}
